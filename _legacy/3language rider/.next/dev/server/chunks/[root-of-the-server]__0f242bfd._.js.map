{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/end/Desktop/WEB/3language%20rider/src/config/index.ts"],"sourcesContent":["// Конфигурация приложения\nexport const config = {\n  // Настройки приложения\n  app: {\n    name: 'Telegram Bot Dashboard',\n    version: '1.0.0',\n    description: 'Панель управления для Telegram ботов',\n  },\n\n  // Базы данных\n  databases: {\n    // Основная база данных приложения\n    main: {\n      url: process.env.DATABASE_URL || 'file:../db/users.db',\n      provider: 'sqlite',\n    },\n    \n    // Шаблон пути для баз данных ботов\n    botTemplate: process.env.BOT_DATABASE_TEMPLATE || 'file:./bot_databases/{botId}/telegram_bot.db',\n    \n    // Директория для баз данных ботов\n    botDirectory: process.env.BOT_DATABASE_DIR || './bots',\n    \n    // Префикс для имен баз ботов\n    botPrefix: process.env.BOT_DATABASE_PREFIX || 'bot_',\n    \n    // Суффикс для имен баз ботов\n    botSuffix: process.env.BOT_DATABASE_SUFFIX || '_db',\n  },\n\n  // Настройки аутентификации\n  auth: {\n    // Секретный ключ для JWT\n    jwtSecret: process.env.JWT_SECRET || 'your-secret-key-change-in-production',\n    \n    // Время жизни токена (в часах)\n    tokenExpiry: process.env.TOKEN_EXPIRY_HOURS ? parseInt(process.env.TOKEN_EXPIRY_HOURS) : 24,\n    \n    // Максимальное количество попыток входа\n    maxLoginAttempts: 5,\n    \n    // Время блокировки после неудачных попыток (в минутах)\n    lockoutDuration: 15,\n  },\n\n  // Настройки сообщений\n  messages: {\n    // Количество сообщений на странице\n    pageSize: 50,\n    \n    // Максимальное количество сообщений для загрузки\n    maxMessages: 1000,\n    \n    // Максимальная длина сообщения\n    maxMessageLength: 4000,\n    \n    // Время автообновления (в секундах)\n    autoRefreshInterval: 30,\n  },\n\n  // Настройки ботов\n  bots: {\n    // Максимальное количество ботов на пользователя\n    maxBotsPerUser: 10,\n    \n    // Длина ID базы данных бота\n    botIdMinLength: 3,\n    botIdMaxLength: 50,\n    \n    // Разрешенные символы для ID бота\n    botIdPattern: /^[a-zA-Z0-9_-]+$/,\n    \n    // Таймаут ответа от API бота (в миллисекундах)\n    apiTimeout: 10000,\n  },\n\n  // Настройки сервера\n  server: {\n    // Порт сервера\n    port: process.env.PORT ? parseInt(process.env.PORT) : 3000,\n    \n    // Хост сервера\n    host: process.env.HOST || 'localhost',\n    \n    // Режим разработки\n    development: process.env.NODE_ENV === 'development',\n    \n    // CORS настройки\n    cors: {\n      origin: process.env.CORS_ORIGIN || 'http://localhost:3000',\n      credentials: true,\n    },\n  },\n\n  // Настройки логирования\n  logging: {\n    // Уровень логирования\n    level: process.env.LOG_LEVEL || 'info',\n    \n    // Файл для логов\n    file: process.env.LOG_FILE || './logs/app.log',\n    \n    // Максимальный размер файла логов (в байтах)\n    maxFileSize: 10 * 1024 * 1024, // 10MB\n    \n    // Количество файлов для ротации\n    maxFiles: 5,\n  },\n\n  // Настройки кэширования\n  cache: {\n    // Время жизни кэша (в секундах)\n    ttl: 300, // 5 минут\n    \n    // Максимальный размер кэша\n    maxSize: 1000,\n    \n    // Интервал очистки кэша (в секундах)\n    cleanupInterval: 600, // 10 минут\n  },\n\n  // Настройки UI\n  ui: {\n    // Количество элементов на странице в таблицах\n    tablePageSize: 20,\n    \n    // Задержка перед показом загрузчика (в миллисекундах)\n    loadingDelay: 200,\n    \n    // Время показа уведомлений (в миллисекундах)\n    notificationDuration: 5000,\n    \n    // Максимальная длина текста для превью\n    previewMaxLength: 100,\n  },\n\n  // API эндпоинты\n  api: {\n    // Базовый URL для API\n    baseUrl: process.env.API_BASE_URL || '/api',\n    \n    // Версия API\n    version: 'v1',\n    \n    // Таймаут для запросов (в миллисекундах)\n    timeout: 30000,\n  },\n\n  // Настройки безопасности\n  security: {\n    // Максимальный размер запроса (в байтах)\n    maxRequestSize: 10 * 1024 * 1024, // 10MB\n    \n    // Ограничение частоты запросов\n    rateLimit: {\n      windowMs: 15 * 60 * 1000, // 15 минут\n      max: 100, // максимум 100 запросов\n    },\n    \n    // Настройки CSRF\n    csrf: {\n      enabled: true,\n      secret: process.env.CSRF_SECRET || 'csrf-secret-key',\n    },\n  },\n};\n\n// Вспомогательные функции для работы с путями баз данных\nexport const getBotDatabasePath = (botId: string): string => {\n  return config.databases.botTemplate.replace('{botId}', botId);\n};\n\nexport const getBotDatabaseUrl = (botId: string): string => {\n  const path = getBotDatabasePath(botId);\n  return `file:${path}`;\n};\n\nexport const isValidBotId = (botId: string): boolean => {\n  return (\n    botId.length >= config.bots.botIdMinLength &&\n    botId.length <= config.bots.botIdMaxLength &&\n    config.bots.botIdPattern.test(botId)\n  );\n};\n\n// Получение полного URL для API\nexport const getApiUrl = (endpoint: string): string => {\n  return `${config.api.baseUrl}/${config.api.version}${endpoint}`;\n};\n\n// Получение текущего окружения\nexport const isDevelopment = (): boolean => config.server.development;\nexport const isProduction = (): boolean => process.env.NODE_ENV === 'production';\nexport const isTest = (): boolean => process.env.NODE_ENV === 'test';\n\nexport default config;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 233, "column": 0}, "map": {"version":3,"sources":["file:///home/end/Desktop/WEB/3language%20rider/src/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\nimport { config } from '@/config'\nimport { join } from 'path'\n\n// Ensure we have a proper database URL\nconst getDatabaseUrl = () => {\n  if (process.env.DATABASE_URL) {\n    // If it's already an absolute path, use it as is\n    if (process.env.DATABASE_URL.startsWith('file:/')) {\n      return process.env.DATABASE_URL\n    }\n    // If it's a relative path, convert to absolute\n    if (process.env.DATABASE_URL.startsWith('file:')) {\n      const relativePath = process.env.DATABASE_URL.replace('file:', '')\n      const absolutePath = join(process.cwd(), relativePath)\n      return `file:${absolutePath}`\n    }\n  }\n  // Use config fallback\n  return config.databases.main.url\n}\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const db =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: config.server.development ? ['query'] : ['error'],\n    datasources: {\n      db: {\n        url: getDatabaseUrl()\n      }\n    }\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = db"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,uCAAuC;AACvC,MAAM,iBAAiB;IACrB,IAAI,QAAQ,GAAG,CAAC,YAAY,EAAE;QAC5B,iDAAiD;QACjD,IAAI,QAAQ,GAAG,CAAC,YAAY,CAAC,UAAU,CAAC,WAAW;YACjD,OAAO,QAAQ,GAAG,CAAC,YAAY;QACjC;QACA,+CAA+C;QAC/C,IAAI,QAAQ,GAAG,CAAC,YAAY,CAAC,UAAU,CAAC,UAAU;YAChD,MAAM,eAAe,QAAQ,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS;YAC/D,MAAM,eAAe,IAAA,yGAAI,EAAC,QAAQ,GAAG,IAAI;YACzC,OAAO,CAAC,KAAK,EAAE,cAAc;QAC/B;IACF;IACA,sBAAsB;IACtB,OAAO,kIAAM,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG;AAClC;AAEA,MAAM,kBAAkB;AAIjB,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,kIAAM,CAAC,MAAM,CAAC,WAAW,GAAG;QAAC;KAAQ,GAAG;QAAC;KAAQ;IACtD,aAAa;QACX,IAAI;YACF,KAAK;QACP;IACF;AACF;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 278, "column": 0}, "map": {"version":3,"sources":["file:///home/end/Desktop/WEB/3language%20rider/src/lib/auth.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\nimport { db } from './db';\nimport { SignJWT, jwtVerify } from 'jose';\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'telegram-bot-secret-key-2024');\n\nexport interface User {\n  id: string;\n  username: string;\n  email: string;\n  botDatabaseId?: string | null;\n  createdAt: Date;\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 12);\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword);\n}\n\nexport async function createUser(username: string, email: string, password: string): Promise<User> {\n  const hashedPassword = await hashPassword(password);\n  \n  const user = await db.user.create({\n    data: {\n      username,\n      email,\n      passwordHash: hashedPassword,\n    },\n    select: {\n      id: true,\n      username: true,\n      email: true,\n      botDatabaseId: true,\n      createdAt: true,\n    },\n  });\n\n  return user;\n}\n\nexport async function authenticateUser(email: string, password: string): Promise<User | null> {\n  const user = await db.user.findUnique({\n    where: { email },\n    select: {\n      id: true,\n      username: true,\n      email: true,\n      passwordHash: true,\n      botDatabaseId: true,\n      createdAt: true,\n    },\n  });\n\n  if (!user) {\n    return null;\n  }\n\n  const isValid = await verifyPassword(password, user.passwordHash);\n  if (!isValid) {\n    return null;\n  }\n\n  const { passwordHash, ...userWithoutPassword } = user;\n  return userWithoutPassword;\n}\n\nexport async function createSession(user: User): Promise<string> {\n  const payload = {\n    userId: user.id,\n    username: user.username,\n    email: user.email,\n    exp: Math.floor(Date.now() / 1000) + 7 * 24 * 60 * 60, // 7 дней\n  };\n\n  return new SignJWT(payload)\n    .setProtectedHeader({ alg: 'HS256' })\n    .setIssuedAt()\n    .setExpirationTime('7d')\n    .sign(JWT_SECRET);\n}\n\nexport async function verifySession(token: string): Promise<User | null> {\n  try {\n    const { payload } = await jwtVerify(token, JWT_SECRET);\n    \n    const user = await db.user.findUnique({\n      where: { id: payload.userId as string },\n      select: {\n        id: true,\n        username: true,\n        email: true,\n        botDatabaseId: true,\n        createdAt: true,\n      },\n    });\n\n    return user;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function updateUserBotDatabaseId(userId: string, botDatabaseId: string | null): Promise<User> {\n  const user = await db.user.update({\n    where: { id: userId },\n    data: { botDatabaseId },\n    select: {\n      id: true,\n      username: true,\n      email: true,\n      botDatabaseId: true,\n      createdAt: true,\n    },\n  });\n\n  return user;\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAAA;;;;AAEA,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAU/D,eAAe,aAAa,QAAgB;IACjD,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,eAAe,WAAW,QAAgB,EAAE,KAAa,EAAE,QAAgB;IAChF,MAAM,iBAAiB,MAAM,aAAa;IAE1C,MAAM,OAAO,MAAM,wHAAE,CAAC,IAAI,CAAC,MAAM,CAAC;QAChC,MAAM;YACJ;YACA;YACA,cAAc;QAChB;QACA,QAAQ;YACN,IAAI;YACJ,UAAU;YACV,OAAO;YACP,eAAe;YACf,WAAW;QACb;IACF;IAEA,OAAO;AACT;AAEO,eAAe,iBAAiB,KAAa,EAAE,QAAgB;IACpE,MAAM,OAAO,MAAM,wHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;QACpC,OAAO;YAAE;QAAM;QACf,QAAQ;YACN,IAAI;YACJ,UAAU;YACV,OAAO;YACP,cAAc;YACd,eAAe;YACf,WAAW;QACb;IACF;IAEA,IAAI,CAAC,MAAM;QACT,OAAO;IACT;IAEA,MAAM,UAAU,MAAM,eAAe,UAAU,KAAK,YAAY;IAChE,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,MAAM,EAAE,YAAY,EAAE,GAAG,qBAAqB,GAAG;IACjD,OAAO;AACT;AAEO,eAAe,cAAc,IAAU;IAC5C,MAAM,UAAU;QACd,QAAQ,KAAK,EAAE;QACf,UAAU,KAAK,QAAQ;QACvB,OAAO,KAAK,KAAK;QACjB,KAAK,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ,IAAI,KAAK,KAAK;IACrD;IAEA,OAAO,IAAI,kKAAO,CAAC,SAChB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,MAClB,IAAI,CAAC;AACV;AAEO,eAAe,cAAc,KAAa;IAC/C,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,sKAAS,EAAC,OAAO;QAE3C,MAAM,OAAO,MAAM,wHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YACpC,OAAO;gBAAE,IAAI,QAAQ,MAAM;YAAW;YACtC,QAAQ;gBACN,IAAI;gBACJ,UAAU;gBACV,OAAO;gBACP,eAAe;gBACf,WAAW;YACb;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAEO,eAAe,wBAAwB,MAAc,EAAE,aAA4B;IACxF,MAAM,OAAO,MAAM,wHAAE,CAAC,IAAI,CAAC,MAAM,CAAC;QAChC,OAAO;YAAE,IAAI;QAAO;QACpB,MAAM;YAAE;QAAc;QACtB,QAAQ;YACN,IAAI;YACJ,UAAU;YACV,OAAO;YACP,eAAe;YACf,WAAW;QACb;IACF;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 403, "column": 0}, "map": {"version":3,"sources":["file:///home/end/Desktop/WEB/3language%20rider/src/app/api/auth/me/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { verifySession } from '@/lib/auth';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const token = request.cookies.get('session-token')?.value;\n    if (!token) {\n      return NextResponse.json(\n        { error: 'Не авторизован' },\n        { status: 401 }\n      );\n    }\n\n    const user = await verifySession(token);\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Сессия недействительна' },\n        { status: 401 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      user: {\n        id: user.id,\n        username: user.username,\n        email: user.email,\n        botDatabaseId: user.botDatabaseId,\n        createdAt: user.createdAt,\n      },\n    });\n  } catch (error) {\n    console.error('Auth me error:', error);\n    return NextResponse.json(\n      { error: 'Внутренняя ошибка сервера' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB;QACpD,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,IAAA,qIAAa,EAAC;QACjC,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,UAAU,KAAK,QAAQ;gBACvB,OAAO,KAAK,KAAK;gBACjB,eAAe,KAAK,aAAa;gBACjC,WAAW,KAAK,SAAS;YAC3B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}